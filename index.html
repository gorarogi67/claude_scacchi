<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Host</title>
    <style>
        /* --- Reset e Variabili --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --text-primary: #333333;
            --border-color: #dddddd;
            --square-light: #f0d9b5;
            --square-dark:  #b58863;
        }
        [data-theme="dark"] {
            --bg-primary: #2e2e2e;
            --bg-secondary: #3c3c3c;
            --text-primary: #e0e0e0;
            --border-color: #555555;
            --square-light: #b58863;
            --square-dark:  #f0d9b5;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
        }
        /* --- Stili Bottoni e Form --- */
        .btn { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; }
        input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }

        /* --- Layout Principale --- */
        .container { max-width: 1200px; margin: auto; padding: 20px; background: var(--bg-primary); border-radius: 8px; }
        .screen { display: none; }
        .screen.active { display: block; }

        /* --- Scacchiera --- */
        .board-container { display: flex; align-items: flex-start; }
        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 0;
            border: 3px solid #333;
        }
        .square { width: 60px; height: 60px; position: relative; }
        .square.white { background-color: var(--square-light); }
        .square.black { background-color: var(--square-dark); }
        .square.selected { background-color: #7fb800 !important; animation: selectedPulse 2s infinite; }
        .square.possible-move::after { content: ''; position: absolute; width: 20px; height: 20px; border-radius: 50%; background: linear-gradient(135deg, #7fb800, #9fd80d); opacity: 0.9; animation: possibleMovePulse 1.5s infinite; }
        @keyframes selectedPulse { 0%,100% { box-shadow: inset 0 0 0 3px #5a8a00; } 50% { box-shadow: inset 0 0 0 3px #7fb800; } }
        @keyframes possibleMovePulse { 0%,100% { opacity: 0.9; } 50% { opacity: 0.6; } }

        /* --- Pezzi Catturati --- */
        #captured-pieces { margin-left: 20px; display: flex; flex-direction: column; gap: 20px; }
        .captured-group h4 { margin: 0 0 5px; font-size: 0.9rem; text-align: center; }
        .captured-list { display: flex; flex-wrap: wrap; gap: 4px; min-height: 40px; border: 1px solid var(--border-color); padding: 5px; border-radius: 4px; background: var(--bg-secondary); }
        .captured-list img { width: 30px; height: 30px; object-fit: contain; }

        /* --- Altri Stili (timer, cronologia mosse, chat, ecc.) --- */
        /* (qui tutto il CSS esistente rimane invariato) */
    </style>
</head>
<body>
    <div class="container">
        <!-- Schermate varie (login, pannello, errore, caricamento, promozione) rimangono identiche -->

        <!-- Schermata di gioco -->
        <div id="game-screen" class="screen">
            <!-- Nomi giocatori e controlli -->
            <div class="player-names">
                <span id="white-name">Giocatore Bianco</span> vs <span id="black-name">Giocatore Nero</span>
            </div>

            <!-- Contenitore Scacchiera con Pezzi Catturati -->
            <div class="board-container" id="board-container">
                <div class="chess-board" id="chess-board" role="grid" aria-label="Scacchiera da gioco"></div>
                <div id="captured-pieces">
                    <div class="captured-group">
                        <h4>Pezzi neri catturati</h4>
                        <div id="captured-black" class="captured-list"></div>
                    </div>
                    <div class="captured-group">
                        <h4>Pezzi bianchi catturati</h4>
                        <div id="captured-white" class="captured-list"></div>
                    </div>
                </div>
            </div>

            <!-- Controlli di gioco, timer, cronologia mosse, chat, ecc. rimangono identici -->
        </div>

        <!-- Altre schermate rimangono identiche -->
    </div>

    <script>
        // (Script Firebase, utility e logica precedenti rimangono invariati)

        // Inizializzazione dello stato di gioco
        let gameState = {};
        gameState.capturedBlack = [];
        gameState.capturedWhite = [];
        let currentGameListener = null;
        let promotionData = null;
        // ... resto delle variabili e funzioni preesistenti ...

        // Funzione per aggiornare e mostrare i pezzi catturati
        function renderCapturedPieces() {
            const blackDiv = document.getElementById('captured-black');
            blackDiv.innerHTML = '';
            gameState.capturedBlack.forEach(type => {
                const img = document.createElement('img');
                img.src = `assets/pieces/black_${type}.png`;
                img.alt = type;
                blackDiv.appendChild(img);
            });
            const whiteDiv = document.getElementById('captured-white');
            whiteDiv.innerHTML = '';
            gameState.capturedWhite.forEach(type => {
                const img = document.createElement('img');
                img.src = `assets/pieces/white_${type}.png`;
                img.alt = type;
                whiteDiv.appendChild(img);
            });
        }

        // Modifica nella logica di cattura (esempio in makeMove o handleCapture):
        // if (victim) {
        //     if (victim.color === 'black') gameState.capturedBlack.push(victim.type);
        //     else gameState.capturedWhite.push(victim.type);
        // }

        // Richiama renderCapturedPieces ogni volta che si ridisegna la scacchiera
        const originalRenderBoard = renderBoard;
        renderBoard = function(...args) {
            originalRenderBoard.apply(this, args);
            renderCapturedPieces();
        };

        // (Il resto dello script rimane invariato)
    </script>
</body>
</html>
